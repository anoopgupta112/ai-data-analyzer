<!DOCTYPE html>
<html>
<head>
  <title>Upload Resumes for JD Match</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1220;--panel:#0f172a;--muted:#9fb0c5;--line:#1e2d49;--acc:#6366f1;--acc2:#22d3ee}
    *{box-sizing:border-box} html,body{margin:0;background:#0b1220;color:#e2e8f0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    /* Nav */
    .nav{position:sticky;top:0;z-index:40;background:linear-gradient(180deg,rgba(2,6,23,.85),rgba(2,6,23,.5));backdrop-filter:blur(8px);border-bottom:1px solid #11213a}
    .nav-inner{max-width:900px;margin:0 auto;display:flex;align-items:center;padding:14px 20px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .dot{width:26px;height:26px;border-radius:8px;background:conic-gradient(from 140deg,#6366f1,#22d3ee,#38bdf8,#6366f1)}
    .links{margin-left:auto;display:flex;gap:12px}
    .link{padding:8px 12px;border-radius:10px;color:#cbd5e1;border:1px solid transparent}
    .link:hover{border-color:#2a3f63;background:#0c1e37}
    /* Card */
    .wrap{max-width:900px;margin:28px auto;padding:0 20px}
    .card{background:linear-gradient(180deg,rgba(148,163,184,.06),rgba(148,163,184,.03));border:1px solid var(--line);border-radius:18px;padding:26px}
    h2{margin:0 0 12px}
    textarea, input[type="file"]{width:100%;margin:10px 0;padding:12px;border-radius:12px;border:1px solid #213456;background:#0b172c;color:#e5edff}
    button{background:linear-gradient(90deg,#6366f1,#22d3ee);color:#fff;border:none;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
    .spinner{display:inline-block;width:20px;height:20px;border:3px solid #fff;border-top:3px solid #22d3ee;border-radius:50%;animation:spin .8s linear infinite;vertical-align:middle;margin-left:10px}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <div class="nav-inner">
      <div class="brand"><span class="dot"></span>Resume Matcher</div>
      <div class="links">
        <a class="link" href="/">Home</a>
        <a class="link" href="/form-builder">Form Builder</a>
        <a class="link" href="/match_results">Results</a>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <h2>Upload Folder of Resumes + Job Description</h2>
      <form onsubmit="handleUpload(event)">
        <label>Paste Job Description:</label>
        <textarea id="jdText" required></textarea>

        <label>Select Resume Folder:</label>
        <input type="file" id="resumeFiles" multiple accept="application/pdf" webkitdirectory mozdirectory>

        <button type="submit" id="matchBtn">
          <span id="btnText">Match with JD</span>
          <span id="btnSpinner" class="spinner" style="display:none;"></span>
        </button>
      </form>
    </div>
  </div>

  <script>
    async function handleUpload(e) {
      e.preventDefault();
      const jd = document.getElementById('jdText').value;
      const files = document.getElementById('resumeFiles').files;
      if (!jd || files.length === 0) {
        alert("JD and at least one resume PDF required.");
        return;
      }
      document.getElementById('btnText').style.display = 'none';
      document.getElementById('btnSpinner').style.display = '';
      document.getElementById('matchBtn').disabled = true;

      try {
        const formData = new FormData();
        formData.append('jd', jd);
        for (let file of files) formData.append('pdf_files', file);

        const res = await fetch('/api/v1/match_from_pdfs', { method:'POST', body:formData });
        const result = await res.json();
        localStorage.setItem('matchResults', JSON.stringify(result));
        window.location.href = '/match_results';
      } finally {
        document.getElementById('btnText').style.display = '';
        document.getElementById('btnSpinner').style.display = 'none';
        document.getElementById('matchBtn').disabled = false;
      }
    }
  </script>
</body>
</html>
